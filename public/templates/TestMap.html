<link rel="stylesheet" href=".\static\stylesheets\format.css">
<link rel="stylesheet" href=".\static\stylesheets\form.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<style>
  body {
    margin: 0;
  }

  .npm canvas {
    background-color: black;
  }

		
		
			
			.qr-btn {
			    background-color:#8c52ff; 
			    padding:8px;
			    color:white;
			    cursor:pointer;
			}
		</style>

<body>
  <input type="text" id="namebox1"> <br> <br>
  <button id="append" onclick="toShowup()">Load</button>
  <img id="display" hidden>
  <img hidden class="testing" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDUxMiA1MTIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxjaXJjbGUgc3R5bGU9ImZpbGw6I0I5RUFGRjsiIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjI1NiIvPg0KPHBhdGggc3R5bGU9ImZpbGw6IzM1Q0NGRjsiIGQ9Ik0xMzIuMTY4LDQ4MC4wOTJDMTY4Ljg2Nyw1MDAuNDE1LDIxMS4wNzgsNTEyLDI1Niw1MTJjMTQxLjM4NSwwLDI1Ni0xMTQuNjE1LDI1Ni0yNTYNCgljMC01MC4zNC0xNC41NC05Ny4yNzktMzkuNjM1LTEzNi44NjdMNDM1LjIzMiw4Mkw2Ni4wNzYsMTY4LjVsMzIuNzMsMzIuNzNsNC43NDUsMTYuNDUxTDY2LjA3Niw0MTRMMTMyLjE2OCw0ODAuMDkyeiIvPg0KPHBvbHlnb24gc3R5bGU9ImZpbGw6IzY2MkU1NzsiIHBvaW50cz0iMjgzLjY2NiwyMjAuMzYzIDI1NS42NjQsMjY4Ljg2NSAyMjcuNjYxLDIyMC4zNjMgIi8+DQo8cG9seWdvbiBzdHlsZT0iZmlsbDojNTkwRjM4OyIgcG9pbnRzPSIyNTUuNjY0LDIyMC4zNjMgMjU1LjY2NCwyNjguODY1IDI4My42NjYsMjIwLjM2MyAiLz4NCjxwb2x5Z29uIHN0eWxlPSJmaWxsOiM5ODMyNjI7IiBwb2ludHM9IjMzNi4zNTQsMjAwLjM2MiAzMjkuMDQ0LDI1NS44ODggMjg0LjYxMywyMjEuNzk0ICIvPg0KPHBvbHlnb24gc3R5bGU9ImZpbGw6IzU5MEYzODsiIHBvaW50cz0iMzc3LjM0NSwxNTkuNDE2IDM5MS44NCwyMTMuNTEzIDMzNy43NDMsMTk5LjAxOCAiLz4NCjxwb2x5Z29uIHN0eWxlPSJmaWxsOiNGRjNGODQ7IiBwb2ludHM9IjE3NS45MiwxOTcuNTg1IDE4My4yMywyNTMuMTEgMjI3LjY2MSwyMTkuMDE3ICIvPg0KPHBvbHlnb24gc3R5bGU9ImZpbGw6IzY2MkU1NzsiIHBvaW50cz0iMTM2LjQ1NywxNTkuNDE2IDEyMS45NjIsMjEzLjUxMyAxNzYuMDU5LDE5OS4wMTggIi8+DQo8cmVjdCB4PSIzNDMiIHk9IjI0OC4zMyIgc3R5bGU9ImZpbGw6I0ZGQjM0NDsiIHdpZHRoPSI0OC43MiIgaGVpZ2h0PSI2Ni4xNyIvPg0KPHJlY3QgeD0iMzEwLjMzIiB5PSIyODEuNDIiIHN0eWxlPSJmaWxsOiNGRkZGRkY7IiB3aWR0aD0iNDAuNjY3IiBoZWlnaHQ9IjMzLjA4Ii8+DQo8cmVjdCB4PSIxMzcuNjciIHk9IjI4MS40MiIgc3R5bGU9ImZpbGw6I0ZGQjM0NDsiIHdpZHRoPSI0MC42NjciIGhlaWdodD0iMzMuMDgiLz4NCjxnPg0KCTxyZWN0IHg9IjgwLjUiIHk9IjE1OCIgc3R5bGU9ImZpbGw6IzMzMzMzMzsiIHdpZHRoPSIyNC41IiBoZWlnaHQ9IjE3MC41Ii8+DQoJPHJlY3QgeD0iNDA3IiB5PSIxNTgiIHN0eWxlPSJmaWxsOiMzMzMzMzM7IiB3aWR0aD0iMjQuNSIgaGVpZ2h0PSIxNzAuNSIvPg0KPC9nPg0KPHBvbHlnb24gc3R5bGU9ImZpbGw6I0YxMzMzRjsiIHBvaW50cz0iNDQ1LjkyNCwxNjguNSA2Ni4wNzYsMTY4LjUgNzYuNzY4LDgyIDQzNS4yMzIsODIgIi8+DQo8cG9seWdvbiBzdHlsZT0iZmlsbDojQUUyODNGOyIgcG9pbnRzPSI0MzUuMjMyLDgyIDI1Ni4zMzMsODIgMjU2LjMzMywxNjguNSA0NDUuOTI0LDE2OC41ICIvPg0KPHJlY3QgeD0iMjI5LjExIiB5PSI4MiIgc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHdpZHRoPSI1NC4yIiBoZWlnaHQ9Ijg2LjUiLz4NCjxnPg0KCTxyZWN0IHg9IjI1Ni4zMyIgeT0iODIiIHN0eWxlPSJmaWxsOiNFMEUwRTA7IiB3aWR0aD0iMjYuOTc3IiBoZWlnaHQ9Ijg2LjUiLz4NCgk8cmVjdCB4PSIzMzcuNTEiIHk9IjgyIiBzdHlsZT0iZmlsbDojRTBFMEUwOyIgd2lkdGg9IjU0LjIiIGhlaWdodD0iODYuNSIvPg0KPC9nPg0KPHJlY3QgeD0iMTIwLjciIHk9IjgyIiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgd2lkdGg9IjU0LjIiIGhlaWdodD0iODYuNSIvPg0KPHJlY3QgeD0iNjYuMDgiIHk9IjMxNC41IiBzdHlsZT0iZmlsbDojRjEzMzNGOyIgd2lkdGg9IjM3OS44NSIgaGVpZ2h0PSI5OS41Ii8+DQo8cmVjdCB4PSIyNTYuMzMiIHk9IjMxNC41IiBzdHlsZT0iZmlsbDojQUUyODNGOyIgd2lkdGg9IjE4OS41OSIgaGVpZ2h0PSI5OS41Ii8+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8L3N2Zz4NCg==" id="testing">
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-database.js"></script>
  <div id="Canvas-Container">
    <script>
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
        apiKey: "AIzaSyB-OBk-Q2Ik7jqRp9XlTCLIL8FPbUhozUA",
        authDomain: "mapproject1-76680.firebaseapp.com",
        databaseURL: "https://mapproject1-76680.firebaseio.com",
        projectId: "mapproject1-76680",
        storageBucket: "mapproject1-76680.appspot.com",
        messagingSenderId: "845059379868",
        appId: "1:845059379868:web:b027db02ef397c849f5359",
        measurementId: "G-WB26Y8VMXC"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>
  <div style="float:left;">

  <h3>xxxxxxxx</h3>
  
    <div>
        <input id="qr-text" type="text" placeholder="Type message QR Code..."/></div> 
    <br/>
    <div>
        <button class="qr-btn" onclick="generateQRCode()">create QR Code</button>
    </div>
    <br/>
  
    <div>

      <canvas id="canvas" style="width:800px; height:600px; border:1px solid gray;"></canvas>

      <div id="MenuContainer" style="float:left;width:110px;"> <!-- div menu panel-->
        
        <div>
          <button  style="width:98px;" class="open-button" onclick="Change(1)">Booth<img src="./static/Icons/icon.png" width="50" length="50"></button>
        </div>
    
        <div>
          <button style="width:98px;" class="open-button" onclick="Change(2)">Toilet<img src="./static/Icons/toilet.png" width="50" length="50"></button>
        </div>

        <div>
          <button style="width:98px;" class="open-button" onclick="Change(3)">Info<img src="./static/Icons/info.png" width="50" length="50"></button>
        </div>
      </div> <!-- end idv menu panel -->

    </div> 
    

    <div class="form-popup" id="CreateForm">
    <canvas id="qr-code"></canvas>

      <form class="form-container" >
        <h1>BoothInfo</h1>
        <label for="text"><b>Booth Name</b></label>
        <input id="DisName" name="DisName" type="text" placeholder="Name">
        <label for="text"><b>Overview</b></label>
        <input id="Description" name="Description" type="text" placeholder="This booth is....">
        <input type="button" class="btn" onclick="DisplayInfo()" placeholder="Title"></input>
        <button type="button" class="btn cancel" onclick="">Close</button>
      </form>
    </div>
  </div>
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
		<script>
			/*
			 https://www.studytonight.com
			 JavaScript
			*/
			var qr;
			
			(function() {
              qr = new QRious({
              element: document.getElementById('qr-code'),  // canvas object
              size: 100, // size image qr code
              value: 'Event Me!!!' // value default text
          });
      })();
      
      function generateQRCode() {
          var qrtext = document.getElementById("qr-text").value; // value  text from text box
          //document.getElementById("qr-result").innerHTML = "QR code for " + qrtext +":"; // get element p object to assign text
          //alert(qrtext); 
          qr.set({
              foreground: 'black', //  setup background color of qr code.
              size: 100, // size image qr code
              value: qrtext // set text for qr
          });
      }
	</script>

  <script src="./static/Javascript/CreateObj.j s"></script>
  <script src="./static/Javascript/index.j s"></script>
  <script src="./static/Javascript/displayimage.js"></script>

  <script>


class BoothIcon {
    constructor(x, y, width, height, src, title, dis) {
        this.x = x
        this.y = y
        this.src = src
        this.width = width
        this.height = height
        this.title = title
        this.dis = dis
    }

    Draw() {
        var B = new Image()
        B.width = this.width
        B.height = this.height
        B.src = this.src
        ctx.drawImage(B, this.x, this.y, this.width, this.height)
        ctx.font = "15px Arial"
        ctx.textAlign = "center"
        ctx.fillText(this.title, this.x + 24, this.y - 10)
    }

    Update() {
        this.Draw()
        this.x = this.x
        this.y = this.y
    }
} // .End BoothIcon

class eraser {
    constructor(x, y, width, height, src) {
        this.x = x
        this.y = y
        this.src = src
        this.width = width
        this.height = height
    }

    Draw() {
        var B = new Image()
        B.width = this.width
        B.height = this.height
        B.src = this.src
        ctx.drawImage(B, this.x, this.y, this.width, this.height)
    }

    Update() {
        this.Draw()
        this.x = this.x
        this.y = this.y
    }
} // .End eraser

function CheckCollition(X, Y, rect2) {
    if (X < rect2.x + rect2.width / 2 &&
        X > rect2.x - rect2.width / 2 &&
        Y < rect2.y + rect2.height / 2 &&
        Y > rect2.y - rect2.height / 2) {
        return true
    }
}

function CheckCollitionImg(rect1, rect2) {
    if (rect1.x < rect2.x + rect2.width &&
        rect1.x + rect1.width > rect2.x &&
        rect1.y < rect2.y + rect2.height &&
        rect1.y + rect1.height > rect2.y) {
        return true
    }
}

function ShowMyForm(x, y, I) {
    var Form = document.getElementById("CreateForm");
    Form.style.display = "block"
    
}

function DisplayInfo() {
    var title = document.getElementById("DisName").value
    var discript = document.getElementById("Description").value
    BoothIcons.push(new BoothIcon(ConX, ConY, 50, 50, "./static/Icons/pin.png", title, discript))
    console.log(BoothIcons[BoothIcons.length - 1].title, MPos.x)
    document.getElementById("CreateForm").style.display = "block"
    On = 0
    document.getElementById("DisName").value = ""
    document.getElementById("Discription").value = ""
}

function Change(M) {
    mode = M
    console.log(M)
} // .End Change

function OpenEdit(B) {
    document.getElementById("EditName").value = B.title
    document.getElementById("EditDis").value = B.dis
    document.getElementById("EditForm").style.display = "block"
}

function ApplyEditBoothInfo() {
    var B = BoothIcons[EditIndex]
    B.title = document.getElementById("EditName").value
    B.dis = document.getElementById("EditDis").value
    document.getElementById("EditForm").style.display = "none"
    document.getElementById("EditName").value = ""
    document.getElementById("EditDis").value = ""
}

function Close(e) {
    document.getElementById(e).style.display = "none"
}

function preview(input) {
    var reader = new FileReader();
    reader.onload = function(e) {
        document.getElementById("display").setAttribute("src", e.target.result);
    };
    reader.readAsDataURL(input.files[0]);
}

function toCanvas() {
    var image = document.getElementById("display");
    Background.push(new eraser(10, 10, canvas.Width,canvas.Height, image))
}

// ----------------------------------------

const MPos = [{
    x: 0,
    y: 0,
}]

// function setupCanvas(canvas) {
//     var dpr = window.devicePixelRatio || 1;
//     var rect = canvas.getBoundingClientRect();
//     canvas.width = rect.width * dpr;
//     canvas.height = rect.height * dpr;
//     var ctx = canvas.getContext('2d');
//     ctx.scale(dpr, dpr);
//     return ctx;
//   }
// var ctx = setupCanvas(document.querySelector('.my-canvas'));

const canvas = document.querySelector("canvas")
const ctx = canvas.getContext('2d')

var mode = 0

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const Background = []
const BoothIcons = []
const ToiletIcons = []
const Infos = []

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height)
    if (Background.length > 0) {
        Background[Background.length-1].Draw()
    }
    requestAnimationFrame(animate)

    BoothIcons.forEach((booth, index) => {
        booth.Update()
        if (CheckCollitionImg(BoothIcon, Eraser) == true) {
            BoothIcons.splice(BoothIcon, 1)
        }
    });

    ToiletIcons.forEach((TI, index) => {
        TI.Update()
    })

    Infos.forEach((TI, index) => {
        TI.Update()
    })

    console.log(BoothIcons.length)
}


const Eraser = new eraser(0, 30, 50, 50, "./static/Icons/Eraser.png")

var ConX = 0
var ConY = 0
var On = 0
var EditIndex = 0

/*
* mode 0 = none 
  mode 1 = Booth 
  mode 2 = Toilet 
  mode 3 = info
  mode 4 = eraser
*/

document.getElementById("canvas").addEventListener("click", (event) => {
    event.preventDefault()
    var border = document.getElementById("canvas").getBoundingClientRect();
    MPos.x = event.clientX - border.left - 25
    MPos.y = event.clientY - border.top - 25
    if (mode == 4) {
        BoothIcons.forEach((A, index) => {
            if (CheckCollition(MPos.x,MPos.y, A) == true) {
                OpenEdit(BoothIcons[index])
                EditIndex = index
            }
        });
        ToiletIcons.forEach((B, index) => {
            if (CheckCollition(MPos.x,MPos.y, B) == true) {
                ToiletIcons.splice(index, 1)
            }
        });
        Infos.forEach((B, index) => {
            if (CheckCollition(MPos.x,MPos.y, B) == true) {
                Infos.splice(index, 1)
            }
        });
    }

    console.log(MPos.y, canvas.height, MPos.x ,canvas.width)

    if (MPos.y < canvas.height && MPos.x < canvas.width) {
        On = 1
        if (mode == 1) {
            ConX = event.clientX - border.left - 25
            ConY = event.clientY - border.top - 25
            //BoothIcons.push(new BoothIcon(MPos.x, MPos.y,50,50,"./static/Icons/Icon.png"))
            var index = 1

             ShowMyForm(MPos.x, MPos.y, index)
        }

        if (mode == 2) {
            ToiletIcons.push(new BoothIcon(MPos.x, MPos.y, 50, 50, "./static/Icons/toilet.png", "Toilet"))
        }

        if (mode == 3) {
            Infos.push(new BoothIcon(MPos.x, MPos.y, 50, 50, "./static/Icons/info.png", "Info"))
        }

        if (CheckCollition(event.clientX, event.clientY, eraser) == true) {
            console.log("Eraser")
        }
    }
})

animate()
  </script>
</body>